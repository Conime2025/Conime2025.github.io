document.addEventListener("DOMContentLoaded",()=>{const c=document.getElementById("notifBtn"),e=document.getElementById("notifModal"),n=e?.querySelector(".notif-container"),p=e?.querySelector(".closeModal"),h=document.querySelector(".mark-all-read"),l=document.getElementById("textMark"),t=document.getElementById("toggleBall"),d=document.getElementById("notifBadge"),u=document.querySelectorAll(".post-notif"),i=new Date,a=[];let s=0;const m=e=>{const t=Math.floor((i-new Date(e))/1e3);return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`};u.forEach(e=>{const l=new Date(e.dataset.date),n=(i-l)/1e3,t=e.dataset.url,d=e.dataset.title||"Notifikasi baru",o=localStorage.getItem(`notif-read:${t}`)==="true",r=document.querySelector(`.fire-new[data-url="${t}"]`),c=document.querySelector(`.label-new[data-url="${t}"]`);if(n<10800&&!o?r?.classList.remove("opacity-0","hidden"):r?.classList.add("opacity-0","hidden"),n<10800?c?.classList.remove("opacity-0","hidden"):c?.classList.add("opacity-0","hidden"),n<10800){const n=!o;n&&s++;const i=n?"bg-conime-500 dark:bg-conime-500":"bg-gray-600 dark:bg-gray-700",r=m(e.dataset.date);a.push(`
        <a href="${t}" class="notif-item bg-gray-100 dark:bg-gray-800/20 rounded p-3 relative block transition hover:bg-gray-200 dark:hover:bg-gray-800 ${o?"opacity-75 dark:opacity-50":""}" data-url="${t}" data-date="${e.dataset.date}">
          <div class="flex justify-end items-right right-2 badge">
            <div class="flex relative justify-center items-center rounded-full">
              <div class="w-3 h-3 opacity-50 rounded-full ${i}"></div>
              <div class="w-2 h-2 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full ${i}"></div>
            </div>
          </div>
          <h2 class="line-clamp-2 w-[80%] text-sm font-light dark:font-extralight text-gray-900 dark:text-white">${d}</h2>
          <p class="w-full text-right text-xs font-light dark:font-extralight"><time datetime="${e.dataset.date}">${r}</time></p>
        </a>
      `)}});const o=()=>{const e=s===0;localStorage.setItem("notif-all-read",e.toString()),e?(t.classList.remove("-translate-x-[85%]"),t.classList.add("translate-x-[85%]","bg-gray-500","dark:bg-gray-500"),t.classList.remove("bg-conime-500","dark:bg-conime-500"),l.innerText="Mark all as unread",d?.classList.add("hidden")):(t.classList.remove("translate-x-[85%]"),t.classList.add("-translate-x-[85%]","bg-conime-500","dark:bg-conime-500"),t.classList.remove("bg-gray-500","dark:bg-gray-500"),l.innerText="Mark all as read",d?.classList.remove("hidden"))};n&&(n.innerHTML=a.length>0?a.join(""):`<div class="text-center text-sm py-4 text-gray-500 dark:text-gray-400">Tidak ada notifikasi baru.</div>`,n.classList.remove("hidden")),n?.querySelectorAll(".notif-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.url;localStorage.setItem(`notif-read:${t}`,"true"),e.classList.add("opacity-75","dark:opacity-50"),e.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-700")});const n=document.querySelector(`.fire-new[data-url="${t}"]`);n?.classList.add("opacity-0","hidden"),s--,o()})}),h?.addEventListener("click",()=>{const t=localStorage.getItem("notif-all-read")==="true",e=(!t).toString();localStorage.setItem("notif-all-read",e),n?.querySelectorAll(".notif-item").forEach(t=>{const n=t.dataset.url,s=document.querySelector(`.fire-new[data-url="${n}"]`),o=(i-new Date(t.dataset.date))/1e3>10800;e==="true"?(localStorage.setItem(`notif-read:${n}`,"true"),t.classList.add("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-700")}),s?.classList.add("opacity-0","hidden")):o||(localStorage.removeItem(`notif-read:${n}`),t.classList.remove("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-gray-600","dark:bg-gray-700"),e.classList.add("bg-conime-500","dark:bg-conime-500")}),s?.classList.remove("opacity-0","hidden"))}),s=e==="true"?0:u.length,o()});const f=()=>{e?.classList.remove("hidden"),requestAnimationFrame(()=>{e?.classList.add("scale-100","opacity-100","translate-y-0"),e?.classList.remove("scale-95","opacity-0","translate-y-6")})},r=()=>{e?.classList.add("scale-95","opacity-0","translate-y-6"),e?.classList.remove("scale-100","opacity-100","translate-y-0"),setTimeout(()=>e?.classList.add("hidden"),300)};c?.addEventListener("click",f),p?.addEventListener("click",r),document.addEventListener("click",t=>{e&&!e.classList.contains("hidden")&&!e.contains(t.target)&&!c.contains(t.target)&&r()}),o()})