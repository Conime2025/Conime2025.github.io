document.addEventListener("DOMContentLoaded",()=>{const h=document.getElementById("notifBtn"),e=document.getElementById("notifModal"),n=e?.querySelector(".notif-container"),g=e?.querySelector(".closeModal"),m=document.querySelector(".mark-all-read"),o=document.getElementById("textMark"),t=document.getElementById("toggleBall"),r=document.getElementById("notifBadge"),c=document.querySelectorAll(".post-notif"),s=new Date,d=[];let i=0;const f=e=>{const t=Math.floor((s-new Date(e))/1e3);return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`};c.forEach(e=>{const c=new Date(e.dataset.date),n=(s-c)/1e3,t=e.dataset.url,l=e.dataset.title||"Notifikasi baru",o=localStorage.getItem(`notif-read:${t}`)==="true",a=document.querySelector(`.fire-new[data-url="${t}"]`),r=document.querySelector(`.label-new[data-url="${t}"]`);if(n<10800&&!o?a?.classList.remove("opacity-0","hidden"):a?.classList.add("opacity-0","hidden"),n<10800?r?.classList.remove("opacity-0","hidden"):r?.classList.add("opacity-0","hidden"),n<10800){const n=!o;n&&i++;const s=n?"bg-conime-500 dark:bg-conime-500":"bg-gray-600 dark:bg-gray-700",a=f(e.dataset.date);d.push(`
        <a href="${t}" class="notif-item bg-gray-100 dark:bg-gray-800/20 rounded p-3 relative block transition hover:bg-gray-200 dark:hover:bg-gray-800 ${o?"opacity-75 dark:opacity-50":""}" data-url="${t}" data-date="${e.dataset.date}">
          <div class="flex justify-end items-right right-2 badge">
            <div class="flex relative justify-center items-center rounded-full">
              <div class="w-3 h-3 opacity-50 rounded-full ${s}"></div>
              <div class="w-2 h-2 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full ${s}"></div>
            </div>
          </div>
          <h2 class="line-clamp-2 w-[80%] text-sm font-light dark:font-extralight text-gray-900 dark:text-white">${l}</h2>
          <p class="w-full text-right text-xs font-light dark:font-extralight"><time datetime="${e.dataset.date}">${a}</time></p>
        </a>
      `)}});const l=()=>{const e=i===0;localStorage.setItem("notif-all-read",e.toString()),e?(t.classList.remove("translate-x-[85%]"),t.classList.add("-translate-x-[85%]","bg-gray-500","dark:bg-gray-500"),t.classList.remove("-bg-conime-500","dark:bg-conime-500"),o.innerText="Mark all as unread",o.setAttribute("data-tippy-content","Mark all as unread")):(t.classList.remove("-translate-x-[85%]"),t.classList.add("translate-x-[85%]","bg-conime-500","dark:bg-conime-500"),t.classList.remove("bg-gray-500","dark:bg-gray-500"),o.innerText="Mark all as read",o.setAttribute("data-tippy-content","Mark all as read"))},u=()=>{const t=localStorage.getItem("notif-all-read")==="true";let e=!1;c.forEach(t=>{const n=localStorage.getItem(`notif-read:${t.dataset.url}`)==="true",o=(s-new Date(t.dataset.date))/1e3;o<10800&&!n&&(e=!0)}),e&&!t?r?.classList.remove("hidden"):r?.classList.add("hidden")};n&&(n.innerHTML=d.length>0?d.join(""):`<div class="text-center text-sm py-4 text-gray-500 dark:text-gray-400">Tidak ada notifikasi baru.</div>`,n.classList.remove("hidden")),n?.querySelectorAll(".notif-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.url;localStorage.setItem(`notif-read:${t}`,"true"),e.classList.add("opacity-75","dark:opacity-50"),e.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-700")});const n=document.querySelector(`.fire-new[data-url="${t}"]`);n?.classList.add("opacity-0","hidden"),r?.classList.add("hidden"),i--,l(),u()})}),m?.addEventListener("click",()=>{const t=localStorage.getItem("notif-all-read")==="true",e=(!t).toString();localStorage.setItem("notif-all-read",e),n?.querySelectorAll(".notif-item").forEach(t=>{const n=t.dataset.url,o=document.querySelector(`.fire-new[data-url="${n}"]`),i=(s-new Date(t.dataset.date))/1e3>10800;e==="true"?(localStorage.setItem(`notif-read:${n}`,"true"),t.classList.add("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-700")}),o?.classList.add("opacity-0","hidden")):i||(localStorage.removeItem(`notif-read:${n}`),t.classList.remove("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-gray-600","dark:bg-gray-700"),e.classList.add("bg-conime-500","dark:bg-conime-500")}),o?.classList.remove("opacity-0","hidden"))}),i=e==="true"?0:c.length,l(),u()});const p=()=>{e?.classList.remove("hidden"),requestAnimationFrame(()=>{e?.classList.add("scale-100","opacity-100","translate-y-0"),e?.classList.remove("scale-95","opacity-0","translate-y-6")})},a=()=>{e?.classList.add("scale-95","opacity-0","translate-y-6"),e?.classList.remove("scale-100","opacity-100","translate-y-0"),setTimeout(()=>e?.classList.add("hidden"),300)},v=()=>{const t=e&&e.classList.contains("scale-100")&&e.classList.contains("opacity-100")&&e.classList.contains("translate-y-0");t?a():p()};h?.addEventListener("click",v),g?.addEventListener("click",a),document.addEventListener("click",t=>{e&&!e.classList.contains("hidden")&&!e.contains(t.target)&&!h.contains(t.target)&&a()}),l(),u()})